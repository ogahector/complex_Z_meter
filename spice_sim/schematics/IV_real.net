* C:\Users\rolando\OneDrive - Imperial College London\EE3\Instrumentation\Coursework 2\complex_Z_meter\spice_sim\schematics\IV_real.asc
R1 N002 N001 {Rref}
V4 Vin 0 SINE(1.65 1.65 100) AC 1
XX2 Vcc powersupply
XU4 Vin N001 Vcc 0 BUF634A
XX4 N002 0 capacitor
XX3 N003 Vadc1 adc
XX5 N004 Vadc2 adc
XU5 N002 N004 Vcc 0 BUF634A
XU6 N001 N003 Vcc 0 BUF634A
C1 N001 0 50p
C2 N002 0 50p

* block symbol definitions
.subckt powersupply Vout
V1 N001 0 SINE({Vdc} 2m 100k) Rser=100m
B1 Vout N001 V=white(10e6*time)/100
.param Vdc={mc(Vset, 0.0075)}
.ends powersupply

.subckt capacitor IN OUT
L1 IN N001 {L}
C1 N001 N002 {Ca}
R1 OUT N002 {R}
.ends capacitor

.subckt adc Vin Vadc
B1 Vadc 0 V={(floor((V(Vb)/vref)*nlevels)/nlevels)*vrange_out}
R_inADC Vb N001 6k
C_ADC Vb 0 7p
B2 N001 Vin V=white(10e6*time)/100
.param nlevels=4096
.param vrange_out 4.096
.param vref = Vdda
.ends adc

* .tran 0 10m 0
.ac dec 100 1 10Meg
.param R=0.1 L=1p Ca=1u Cb=0
* .noise V(vadc2) V1 dec 100 10 1Meg
* Analysis
* Voltages
.meas AC ideal_output PARAM V(n002)/I(X1)
.param Rref=1k
.meas AC real_read_output PARAM V(vadc2)/I(X1)
* DUT parameters
.param Vdda 3.3
.param Vset 15
* Stray capacitances
.lib C:\Users\rolando\OneDrive - Imperial College London\EE3\Instrumentation\Coursework 2\complex_Z_meter\spice_sim\models\buf634a_a.lib
.backanno
.end
